{% extends "base.html" %}
{% block header_breadcrumbs %}
  <div class="header-breadcrumbs">
    <a href="{{ root }}/">Home</a> <span class="sep">&gt;</span> Recent
  </div>
{% endblock %}
{% block content %}
  <div class="page-header">
    <h1>Recent Translations from ChinaXiv</h1>
    <p class="page-description">
      Automatically translated preprints from the Chinese arXiv (ChinaXiv).
    </p>
    <p class="paper-count">{{ items|length }} papers translated</p>
  </div>

  {# ========================================================================
     LAYOUT CHANGE: Search bar now appears BEFORE category pills
     Rationale: Logical flow - search first, then filter by category
     ======================================================================== #}

  <div class="search-block" id="search-section">
    <div class="search-input-group">
      <input id="search-input" placeholder="Search by title, authors, or abstract…" />
      <button class="search-btn">Search</button>
    </div>

    {# V2 TODO: Consider removing redundant filter controls
       - Category dropdown duplicates pills (below)
       - Consider keeping only pills for major categories + "More" dropdown
       - Or keep dropdown hidden and show on "Advanced Filters" click #}
    <div class="search-filters">
      <div class="filter-group">
        <label for="category-filter">Category:</label>
        <select id="category-filter">
          <option value="">All Categories</option>
          {% for name, count in categories %}
          <option value="{{ name }}">{{ name }} ({{ count }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="filter-group">
        <label for="date-filter">Date:</label>
        <select id="date-filter">
          <option value="">All Dates</option>
          <option value="7d">Last 7 days</option>
          <option value="30d">Last 30 days</option>
          <option value="90d">Last 90 days</option>
          <option value="1y">Last year</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="sort-order">Sort:</label>
        <select id="sort-order">
          <option value="relevance" selected>Relevance</option>
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
        </select>
      </div>
      <div class="filter-group filter-checkbox">
        <label>
          <input type="checkbox" id="figures-filter" />
          Only show papers with figures
        </label>
      </div>
    </div>
  </div>

  {# Category Pills - Moved BELOW search for better UX flow #}
  <nav class="subject-nav" role="navigation" aria-label="Quick category filters">
    <button class="subject-nav-pill active" data-subject="">All Recent</button>
    {% for name, count in categories %}
    <button class="subject-nav-pill" data-subject="{{ name }}">{{ name }}</button>
    {% endfor %}
  </nav>

  {# ========================================================================
     UNIFIED CONTAINER ARCHITECTURE
     ======================================================================== #}
  {# V1: Single container for all article display
     - No more dual-container toggle between #articles and #search-results
     - JavaScript will filter and re-render this same container
     - Simpler, more maintainable architecture

     V2 TODO (when dataset > 5K papers):
     - Add "Load More" button after first 200 results
     - Or implement virtual scrolling for smooth infinite scroll
     - See project docs and assets/site.js for detailed V2 implementation notes
     ======================================================================== #}
  <div id="articles" class="article-list">
    {% for it in items %}
      <article class="paper-card">
        <h3 class="paper-title">
          <a href="{{ root }}/items/{{ it.id }}/" title="Abstract">{{ it.title_en or it.title }}</a>
        </h3>
        <div class="paper-meta-row">
          <span class="paper-authors">{{ ', '.join(it.creators_en or it.creators or ['Unknown']) }}</span>
        </div>
        <div class="paper-meta-row secondary">
          <span class="paper-date">{{ it.date|human_date }}</span>
          <span class="paper-id">ChinaXiv:{{ it.id }}</span>
          {% if it.subjects or it.subjects_en %}
            <span class="paper-subjects">
              {% for s in (it.subjects_en or it.subjects)[:3] %}
                <span class="subject-tag" data-subject="{{ s|e }}">{{ s }}</span>
              {% endfor %}
            </span>
          {% endif %}
          <div class="paper-links">
            <a href="{{ root }}/items/{{ it.id }}/" class="btn-sm">Abstract</a>
            {% if it.pdf_url %}
              <a href="{{ it.pdf_url }}" class="btn-sm">PDF</a>
            {% endif %}
          </div>
        </div>
        <p class="paper-abstract">
          {{ it.abstract_en[:300] }}{% if it.abstract_en and it.abstract_en|length > 300 %}…{% endif %}
        </p>
      </article>
    {% endfor %}
  </div>

  {% if not items %}
    <p style="color: #777; font-style: italic; margin-top: 40px;">No translations available yet.</p>
  {% endif %}
{% endblock %}
