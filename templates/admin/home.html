{% extends 'admin/base.html' %}
{% block content %}
  {% if cfg_error %}
    <p class="fail">Config error: {{ cfg_error }}</p>
    <p>Set <code>GH_TOKEN</code> and <code>GH_REPO</code>, and <code>ADMIN_PASSWORD</code> in your environment.</p>
  {% else %}
    <div class="grid">
      <div>
        <h2>Workflows (sample)</h2>
        <table>
          <tr><th>Name</th><th>File</th><th>State</th><th>Created (local)</th></tr>
          {% for w in workflows %}
          <tr>
            <td>{{ w.name }}</td>
            <td class="muted">{{ w.path }}</td>
            <td>{{ w.state }}</td>
            <td class="muted">{{ w.created_at | dt_local }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
      <div>
        <h2>Recent Runs</h2>
        <table>
          <tr><th>Workflow</th><th>Branch</th><th>Status</th><th>Conclusion</th><th>Started (local)</th><th>Updated (local)</th><th>Duration</th></tr>
          {% for r in latest_runs %}
          <tr>
            <td><a href="/admin/ci/run/{{ r.id }}">{{ r.name }}</a></td>
            <td>{{ r.head_branch }}</td>
            <td>{{ r.status }}</td>
            <td>{% if r.conclusion %}{{ r.conclusion }}{% else %}<span class="muted">(pending)</span>{% endif %}</td>
            <td class="muted">{{ r.run_started_at | dt_local }}</td>
            <td class="muted">{{ r.updated_at | dt_local }}</td>
            <td class="muted">{{ r.run_started_at | duration(r.updated_at) }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  {% endif %}
{% endblock %}
