# TODO: Migrate to Flask endpoint or cron job on Railway - see TODO.md
# Current functionality: Coordinates backfill workflow orchestration
# Uses Durable Objects with SQLite - will need PostgreSQL equivalent

name = "chinarxiv-backfill-orchestrator"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Durable Object bindings
[[durable_objects.bindings]]
name = "BACKFILL_ORCHESTRATOR"
class_name = "BackfillOrchestrator"

# Migrations for Durable Objects (using SQLite for free plan)
[[migrations]]
tag = "v1"
new_sqlite_classes = ["BackfillOrchestrator"]

# Environment variables (secrets set via wrangler secret put)
# ADMIN_USERNAME - Basic auth username
# ADMIN_PASSWORD - Basic auth password
# GITHUB_TOKEN - GitHub personal access token with workflow permissions
# GITHUB_REPO - Repository in format "owner/repo"

[vars]
GITHUB_REPO = "domus-magna/chinarxiv"
WORKFLOW_FILE = "backfill.yml"
POLL_INTERVAL_MS = "300000"  # 5 minutes

# Production environment
[env.production]
name = "chinarxiv-backfill-orchestrator"
